Now I have all the context I need. Let me create the comprehensive implementation plan with copy-paste ready code.

---

# Web UI Routing and Layout Components - Implementation Plan

## Overview

This document provides exhaustive implementation details for the Tether mobile-first React web UI with bottom tab navigation (iOS-style) and settings drawer. The implementation uses Vite + React + TypeScript with shadcn/ui, React Query for server state, and React Router for navigation.

---

## 1. Project Structure

```
src/
├── main.tsx                          # Entry point
├── App.tsx                           # Root component with providers
├── lib/
│   ├── queryClient.ts                # React Query client configuration
│   └── utils.ts                      # Utility functions (cn helper)
├── hooks/
│   └── useOnboardingState.ts         # Hook to check onboarding status
├── components/
│   ├── layout/
│   │   ├── AppShell.tsx              # Main layout wrapper
│   │   └── MobileNav.tsx             # Bottom tab navigation
│   └── ui/                           # shadcn/ui components
│       ├── button.tsx
│       ├── drawer.tsx
│       └── ... (other shadcn components)
├── pages/
│   ├── OnboardingPage.tsx            # Onboarding flow
│   └── DashboardPage.tsx             # Main dashboard with tabs
└── client/                           # Generated API client (from openapi-ts)
    ├── client.gen.ts
    ├── sdk.gen.ts
    └── @tanstack/
        └── react-query.gen.ts
```

---

## 2. File: `src/main.tsx`

**Purpose:** Application entry point with React 18 strict mode and root mounting.

```tsx
// =============================================================================
// File: src/main.tsx
// Description: Application entry point. Mounts the React app with StrictMode.
// =============================================================================

import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import App from './App';
import './index.css';

// -----------------------------------------------------------------------------
// Root Element Validation
// -----------------------------------------------------------------------------
const rootElement = document.getElementById('root');

if (!rootElement) {
  throw new Error(
    'Failed to find the root element. Ensure your index.html contains <div id="root"></div>'
  );
}

// -----------------------------------------------------------------------------
// Application Mount
// -----------------------------------------------------------------------------
createRoot(rootElement).render(
  <StrictMode>
    <App />
  </StrictMode>
);
```

---

## 3. File: `src/lib/utils.ts`

**Purpose:** Utility functions including the `cn()` helper for conditional Tailwind class merging.

```tsx
// =============================================================================
// File: src/lib/utils.ts
// Description: Utility functions for the application.
// =============================================================================

import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

// -----------------------------------------------------------------------------
// cn() - Class Name Utility
// -----------------------------------------------------------------------------
// Combines clsx for conditional classes with tailwind-merge to properly
// handle Tailwind CSS class conflicts. This is the standard pattern for
// shadcn/ui components.
//
// Usage:
//   cn('px-4 py-2', isActive && 'bg-blue-500', className)
//   cn('text-sm', { 'font-bold': isBold, 'text-red-500': hasError })
// -----------------------------------------------------------------------------
export function cn(...inputs: ClassValue[]): string {
  return twMerge(clsx(inputs));
}
```

**Dependencies to install:**
```bash
bun add clsx tailwind-merge
```

---

## 4. File: `src/lib/queryClient.ts`

**Purpose:** React Query client configuration with sensible defaults for mobile use.

```tsx
// =============================================================================
// File: src/lib/queryClient.ts
// Description: React Query client configuration with mobile-optimized defaults.
// =============================================================================

import { QueryClient } from '@tanstack/react-query';

// -----------------------------------------------------------------------------
// Query Client Configuration
// -----------------------------------------------------------------------------
// These defaults are optimized for a mobile-first application running on a
// local network with a Raspberry Pi backend.
//
// Key considerations:
// - staleTime: 30 seconds - Data is considered fresh for 30s before refetching
// - gcTime: 5 minutes - Unused data is garbage collected after 5 minutes
// - retry: 2 - Retry failed requests twice (network can be flaky on Pi)
// - refetchOnWindowFocus: true - Refetch when user returns to app
// - refetchOnReconnect: true - Refetch when network reconnects
// -----------------------------------------------------------------------------

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // Time in milliseconds before data is considered stale
      staleTime: 30 * 1000, // 30 seconds

      // Time in milliseconds that unused/inactive cache data remains in memory
      // Previously called 'cacheTime' in v4, renamed to 'gcTime' in v5
      gcTime: 5 * 60 * 1000, // 5 minutes

      // Number of retry attempts for failed queries
      retry: 2,

      // Delay between retries (exponential backoff)
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),

      // Refetch behavior
      refetchOnWindowFocus: true,
      refetchOnReconnect: true,
      refetchOnMount: true,

      // Network mode - always attempt to fetch, fall back to cache if offline
      networkMode: 'offlineFirst',
    },
    mutations: {
      // Retry mutations once on failure
      retry: 1,

      // Network mode for mutations
      networkMode: 'offlineFirst',
    },
  },
});

// -----------------------------------------------------------------------------
// Query Keys Factory
// -----------------------------------------------------------------------------
// Centralized query key management for cache invalidation and prefetching.
// Follow the convention: [entity, ...params]
// -----------------------------------------------------------------------------
export const queryKeys = {
  // Onboarding state
  onboarding: {
    all: ['onboarding'] as const,
    status: () => [...queryKeys.onboarding.all, 'status'] as const,
  },

  // Bluetooth device status
  device: {
    all: ['device'] as const,
    proximity: () => [...queryKeys.device.all, 'proximity'] as const,
    signalStrength: () => [...queryKeys.device.all, 'signal-strength'] as const,
  },

  // Pass management
  passes: {
    all: ['passes'] as const,
    remaining: () => [...queryKeys.passes.all, 'remaining'] as const,
    history: (month?: string) =>
      [...queryKeys.passes.all, 'history', month ?? 'current'] as const,
  },

  // Configuration
  config: {
    all: ['config'] as const,
    wifi: () => [...queryKeys.config.all, 'wifi'] as const,
    bluetooth: () => [...queryKeys.config.all, 'bluetooth'] as const,
    timezone: () => [...queryKeys.config.all, 'timezone'] as const,
    ticket: () => [...queryKeys.config.all, 'ticket'] as const,
  },
} as const;
```

**Dependencies to install:**
```bash
bun add @tanstack/react-query
```

---

## 5. File: `src/hooks/useOnboardingState.ts`

**Purpose:** Hook to check if onboarding is complete via API. Used for routing logic.

```tsx
// =============================================================================
// File: src/hooks/useOnboardingState.ts
// Description: Hook to check onboarding completion status from the API.
// =============================================================================

import { useQuery, type UseQueryResult } from '@tanstack/react-query';
import { queryKeys } from '@/lib/queryClient';

// -----------------------------------------------------------------------------
// Types
// -----------------------------------------------------------------------------

/**
 * Onboarding status response from the API.
 * The API returns whether onboarding has been completed.
 */
export interface OnboardingStatus {
  /** Whether the initial onboarding flow has been completed */
  is_complete: boolean;

  /** Current onboarding step if not complete (null if complete) */
  current_step: OnboardingStep | null;

  /** Total number of onboarding steps */
  total_steps: number;
}

/**
 * Possible onboarding steps in sequence.
 */
export type OnboardingStep =
  | 'bluetooth_device'
  | 'signal_threshold'
  | 'passes_config'
  | 'wifi_primary'
  | 'wifi_additional'
  | 'timezone'
  | 'complete';

/**
 * Return type for the useOnboardingState hook.
 */
export interface UseOnboardingStateReturn {
  /** Whether onboarding is complete */
  isOnboardingComplete: boolean;

  /** Current step in onboarding (null if complete) */
  currentStep: OnboardingStep | null;

  /** Whether the query is currently loading */
  isLoading: boolean;

  /** Whether the initial data load is happening */
  isInitialLoading: boolean;

  /** Error if the query failed */
  error: Error | null;

  /** Refetch function to manually refresh the status */
  refetch: () => Promise<UseQueryResult<OnboardingStatus, Error>>;
}

// -----------------------------------------------------------------------------
// API Fetch Function
// -----------------------------------------------------------------------------

/**
 * Fetches the onboarding status from the API.
 * This endpoint should be available even before onboarding is complete.
 */
async function fetchOnboardingStatus(): Promise<OnboardingStatus> {
  const response = await fetch('/api/onboarding/status', {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
    },
  });

  if (!response.ok) {
    // Handle specific error cases
    if (response.status === 503) {
      throw new Error('Service is starting up. Please wait...');
    }
    throw new Error(`Failed to fetch onboarding status: ${response.statusText}`);
  }

  return response.json();
}

// -----------------------------------------------------------------------------
// Hook: useOnboardingState
// -----------------------------------------------------------------------------

/**
 * Hook to check if the onboarding flow has been completed.
 *
 * This hook is used by the App component to determine whether to redirect
 * the user to the onboarding flow or the main dashboard.
 *
 * @example
 * ```tsx
 * function AppRouter() {
 *   const { isOnboardingComplete, isLoading } = useOnboardingState();
 *
 *   if (isLoading) {
 *     return <LoadingSpinner />;
 *   }
 *
 *   return isOnboardingComplete ? <Dashboard /> : <Onboarding />;
 * }
 * ```
 */
export function useOnboardingState(): UseOnboardingStateReturn {
  const query = useQuery<OnboardingStatus, Error>({
    queryKey: queryKeys.onboarding.status(),
    queryFn: fetchOnboardingStatus,

    // Cache the onboarding status for longer since it rarely changes
    staleTime: 60 * 1000, // 1 minute

    // Keep in cache for 10 minutes
    gcTime: 10 * 60 * 1000,

    // Don't retry too aggressively for this critical query
    retry: 3,
    retryDelay: 1000,

    // Refetch on mount to ensure we have fresh data on app start
    refetchOnMount: 'always',
  });

  return {
    isOnboardingComplete: query.data?.is_complete ?? false,
    currentStep: query.data?.current_step ?? null,
    isLoading: query.isLoading,
    isInitialLoading: query.isLoading && !query.data,
    error: query.error,
    refetch: query.refetch,
  };
}

// -----------------------------------------------------------------------------
// Alternative: Using Generated Client (when available)
// -----------------------------------------------------------------------------
// Once the API client is generated via openapi-ts, replace the manual fetch
// with the generated hooks. Example:
//
// import { getOnboardingStatusOptions } from '@/client/@tanstack/react-query.gen';
//
// export function useOnboardingState(): UseOnboardingStateReturn {
//   const query = useQuery({
//     ...getOnboardingStatusOptions(),
//     staleTime: 60 * 1000,
//   });
//
//   return {
//     isOnboardingComplete: query.data?.is_complete ?? false,
//     currentStep: query.data?.current_step ?? null,
//     isLoading: query.isLoading,
//     isInitialLoading: query.isLoading && !query.data,
//     error: query.error,
//     refetch: query.refetch,
//   };
// }
// -----------------------------------------------------------------------------
```

---

## 6. File: `src/App.tsx`

**Purpose:** Root component with all providers, routing configuration, and redirect logic.

```tsx
// =============================================================================
// File: src/App.tsx
// Description: Root application component with providers and routing.
// =============================================================================

import { Suspense, lazy, type ReactNode } from 'react';
import { QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import {
  BrowserRouter,
  Routes,
  Route,
  Navigate,
  Outlet,
  useLocation,
} from 'react-router-dom';
import { ErrorBoundary } from 'react-error-boundary';

import { queryClient } from '@/lib/queryClient';
import { useOnboardingState } from '@/hooks/useOnboardingState';
import { AppShell } from '@/components/layout/AppShell';

// -----------------------------------------------------------------------------
// Lazy-loaded Pages
// -----------------------------------------------------------------------------
// Using React.lazy for code splitting - pages are loaded on demand
const OnboardingPage = lazy(() => import('@/pages/OnboardingPage'));
const DashboardPage = lazy(() => import('@/pages/DashboardPage'));

// -----------------------------------------------------------------------------
// Loading Components
// -----------------------------------------------------------------------------

/**
 * Full-page loading spinner shown during initial app load or route transitions.
 */
function PageLoadingFallback(): ReactNode {
  return (
    <div className="flex h-screen w-full items-center justify-center bg-background">
      <div className="flex flex-col items-center gap-4">
        <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
        <p className="text-sm text-muted-foreground">Loading...</p>
      </div>
    </div>
  );
}

/**
 * Compact loading spinner for smaller loading states.
 */
function LoadingSpinner(): ReactNode {
  return (
    <div className="flex h-full w-full items-center justify-center p-8">
      <div className="h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent" />
    </div>
  );
}

// -----------------------------------------------------------------------------
// Error Boundary Fallback
// -----------------------------------------------------------------------------

interface ErrorFallbackProps {
  error: Error;
  resetErrorBoundary: () => void;
}

/**
 * Error fallback UI shown when an unhandled error occurs.
 */
function ErrorFallback({ error, resetErrorBoundary }: ErrorFallbackProps): ReactNode {
  return (
    <div className="flex h-screen w-full flex-col items-center justify-center gap-4 bg-background p-4">
      <div className="rounded-lg border border-destructive/50 bg-destructive/10 p-6 text-center">
        <h2 className="mb-2 text-lg font-semibold text-destructive">
          Something went wrong
        </h2>
        <p className="mb-4 text-sm text-muted-foreground">
          {error.message || 'An unexpected error occurred'}
        </p>
        <button
          onClick={resetErrorBoundary}
          className="rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90"
        >
          Try again
        </button>
      </div>
    </div>
  );
}

// -----------------------------------------------------------------------------
// Protected Route Component
// -----------------------------------------------------------------------------

interface ProtectedRouteProps {
  /** Require onboarding to be complete to access this route */
  requireOnboarding?: boolean;
  /** Redirect to this path if condition is not met */
  redirectTo?: string;
  /** Children to render if access is granted */
  children?: ReactNode;
}

/**
 * Route wrapper that handles authentication/onboarding state.
 * Redirects users based on their onboarding completion status.
 */
function ProtectedRoute({
  requireOnboarding = true,
  redirectTo,
  children,
}: ProtectedRouteProps): ReactNode {
  const location = useLocation();
  const { isOnboardingComplete, isInitialLoading } = useOnboardingState();

  // Show loading state while checking onboarding status
  if (isInitialLoading) {
    return <LoadingSpinner />;
  }

  // Redirect logic based on onboarding state
  if (requireOnboarding && !isOnboardingComplete) {
    // User needs to complete onboarding first
    return <Navigate to="/onboarding" state={{ from: location }} replace />;
  }

  if (!requireOnboarding && isOnboardingComplete) {
    // User has completed onboarding, redirect to dashboard
    return <Navigate to={redirectTo || '/dashboard'} replace />;
  }

  // Render children or Outlet for nested routes
  return children ?? <Outlet />;
}

// -----------------------------------------------------------------------------
// Root Redirect Component
// -----------------------------------------------------------------------------

/**
 * Handles the root path redirect based on onboarding state.
 */
function RootRedirect(): ReactNode {
  const { isOnboardingComplete, isInitialLoading } = useOnboardingState();

  if (isInitialLoading) {
    return <PageLoadingFallback />;
  }

  // Redirect to appropriate page based on onboarding status
  return <Navigate to={isOnboardingComplete ? '/dashboard' : '/onboarding'} replace />;
}

// -----------------------------------------------------------------------------
// App Routes Component
// -----------------------------------------------------------------------------

/**
 * Application routes configuration.
 * Separated from App for cleaner organization.
 */
function AppRoutes(): ReactNode {
  return (
    <Routes>
      {/* Root redirect - checks onboarding state and redirects */}
      <Route path="/" element={<RootRedirect />} />

      {/* Onboarding route - only accessible if NOT onboarded */}
      <Route
        path="/onboarding"
        element={
          <ProtectedRoute requireOnboarding={false} redirectTo="/dashboard">
            <Suspense fallback={<PageLoadingFallback />}>
              <OnboardingPage />
            </Suspense>
          </ProtectedRoute>
        }
      />

      {/* Dashboard route - only accessible if onboarded */}
      <Route
        path="/dashboard"
        element={
          <ProtectedRoute requireOnboarding={true}>
            <AppShell>
              <Suspense fallback={<LoadingSpinner />}>
                <DashboardPage />
              </Suspense>
            </AppShell>
          </ProtectedRoute>
        }
      />

      {/* Catch-all redirect to root */}
      <Route path="*" element={<Navigate to="/" replace />} />
    </Routes>
  );
}

// -----------------------------------------------------------------------------
// Main App Component
// -----------------------------------------------------------------------------

/**
 * Root application component.
 *
 * Provider hierarchy (outermost to innermost):
 * 1. ErrorBoundary - Catches unhandled errors
 * 2. QueryClientProvider - React Query state management
 * 3. BrowserRouter - React Router navigation
 * 4. AppRoutes - Route definitions
 */
function App(): ReactNode {
  return (
    <ErrorBoundary
      FallbackComponent={ErrorFallback}
      onReset={() => {
        // Clear React Query cache on error reset
        queryClient.clear();
        // Reload the page to reset all state
        window.location.href = '/';
      }}
    >
      <QueryClientProvider client={queryClient}>
        <BrowserRouter>
          <AppRoutes />
        </BrowserRouter>

        {/* React Query Devtools - only in development */}
        {import.meta.env.DEV && (
          <ReactQueryDevtools
            initialIsOpen={false}
            position="bottom"
            buttonPosition="bottom-left"
          />
        )}
      </QueryClientProvider>
    </ErrorBoundary>
  );
}

export default App;
```

**Dependencies to install:**
```bash
bun add react-router-dom react-error-boundary @tanstack/react-query-devtools
```

---

## 7. File: `src/components/layout/MobileNav.tsx`

**Purpose:** iOS-style bottom tab navigation with active state styling.

```tsx
// =============================================================================
// File: src/components/layout/MobileNav.tsx
// Description: iOS-style bottom tab navigation for mobile-first layout.
// =============================================================================

import { type ReactNode, useMemo } from 'react';
import { NavLink, useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';

// -----------------------------------------------------------------------------
// Types
// -----------------------------------------------------------------------------

/**
 * Navigation tab definition.
 */
interface NavTab {
  /** Unique identifier for the tab */
  id: string;
  /** Display label for the tab */
  label: string;
  /** URL search params to set when this tab is active */
  tabParam: string;
  /** Icon component to render */
  icon: (props: { className?: string; isActive: boolean }) => ReactNode;
}

/**
 * Props for the MobileNav component.
 */
interface MobileNavProps {
  /** Optional additional CSS classes */
  className?: string;
}

// -----------------------------------------------------------------------------
// Icons
// -----------------------------------------------------------------------------
// Using inline SVG icons for simplicity. These follow iOS SF Symbols style.
// In production, you might want to use lucide-react or similar.

function StatusIcon({
  className,
  isActive,
}: {
  className?: string;
  isActive: boolean;
}): ReactNode {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill={isActive ? 'currentColor' : 'none'}
      stroke="currentColor"
      strokeWidth={isActive ? 0 : 1.5}
      className={className}
    >
      {isActive ? (
        // Filled version
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
      ) : (
        // Outline version
        <>
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </>
      )}
    </svg>
  );
}

function PassesIcon({
  className,
  isActive,
}: {
  className?: string;
  isActive: boolean;
}): ReactNode {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill={isActive ? 'currentColor' : 'none'}
      stroke="currentColor"
      strokeWidth={isActive ? 0 : 1.5}
      className={className}
    >
      {isActive ? (
        // Filled ticket icon
        <path d="M22 10V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v4c1.1 0 2 .9 2 2s-.9 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2zm-9 7.5h-2v-2h2v2zm0-4.5h-2v-2h2v2zm0-4.5h-2v-2h2v2z" />
      ) : (
        // Outline ticket icon
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 010 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 010-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375z"
        />
      )}
    </svg>
  );
}

function SettingsIcon({
  className,
  isActive,
}: {
  className?: string;
  isActive: boolean;
}): ReactNode {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill={isActive ? 'currentColor' : 'none'}
      stroke="currentColor"
      strokeWidth={isActive ? 0 : 1.5}
      className={className}
    >
      {isActive ? (
        // Filled gear icon
        <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
      ) : (
        // Outline gear icon
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"
        />
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
        />
      )}
    </svg>
  );
}

// -----------------------------------------------------------------------------
// Navigation Tabs Configuration
// -----------------------------------------------------------------------------

const NAV_TABS: NavTab[] = [
  {
    id: 'status',
    label: 'Status',
    tabParam: 'status',
    icon: StatusIcon,
  },
  {
    id: 'passes',
    label: 'Passes',
    tabParam: 'passes',
    icon: PassesIcon,
  },
  {
    id: 'settings',
    label: 'Settings',
    tabParam: 'settings',
    icon: SettingsIcon,
  },
];

// -----------------------------------------------------------------------------
// MobileNav Component
// -----------------------------------------------------------------------------

/**
 * iOS-style bottom tab navigation component.
 *
 * Features:
 * - Fixed to bottom of screen
 * - Three tabs: Status, Passes, Settings
 * - Active state with filled icons
 * - Safe area padding for notched devices
 * - Haptic-style visual feedback
 *
 * @example
 * ```tsx
 * <div className="flex flex-col h-screen">
 *   <main className="flex-1 overflow-auto">
 *     {content}
 *   </main>
 *   <MobileNav />
 * </div>
 * ```
 */
export function MobileNav({ className }: MobileNavProps): ReactNode {
  const location = useLocation();

  // Parse current tab from URL search params
  const currentTab = useMemo(() => {
    const params = new URLSearchParams(location.search);
    return params.get('tab') || 'status';
  }, [location.search]);

  return (
    <nav
      className={cn(
        // Base styles
        'fixed inset-x-0 bottom-0 z-50',
        // Background with blur effect (iOS style)
        'border-t border-border/40 bg-background/80 backdrop-blur-lg',
        // Safe area padding for notched devices
        'pb-[env(safe-area-inset-bottom,0px)]',
        className
      )}
      role="navigation"
      aria-label="Main navigation"
    >
      <div className="flex h-16 items-stretch justify-around">
        {NAV_TABS.map((tab) => {
          const isActive = currentTab === tab.tabParam;
          const Icon = tab.icon;

          return (
            <NavLink
              key={tab.id}
              to={`/dashboard?tab=${tab.tabParam}`}
              className={cn(
                // Base styles
                'flex flex-1 flex-col items-center justify-center gap-1',
                // Touch target (minimum 44x44 for accessibility)
                'min-h-[44px] min-w-[44px]',
                // Transition
                'transition-colors duration-150',
                // Active/inactive states
                isActive
                  ? 'text-primary'
                  : 'text-muted-foreground hover:text-foreground'
              )}
              aria-current={isActive ? 'page' : undefined}
            >
              <Icon className="h-6 w-6" isActive={isActive} />
              <span
                className={cn(
                  'text-[10px] font-medium leading-none',
                  isActive ? 'text-primary' : 'text-muted-foreground'
                )}
              >
                {tab.label}
              </span>
            </NavLink>
          );
        })}
      </div>
    </nav>
  );
}

// -----------------------------------------------------------------------------
// Exports
// -----------------------------------------------------------------------------

export { NAV_TABS };
export type { NavTab, MobileNavProps };
```

---

## 8. File: `src/components/layout/AppShell.tsx`

**Purpose:** Main layout wrapper with scrollable content, bottom navigation, and settings drawer.

```tsx
// =============================================================================
// File: src/components/layout/AppShell.tsx
// Description: Main application shell with layout, navigation, and drawer.
// =============================================================================

import { type ReactNode, useState, useCallback, createContext, useContext } from 'react';
import { useSearchParams } from 'react-router-dom';
import { cn } from '@/lib/utils';
import { MobileNav } from '@/components/layout/MobileNav';
import {
  Drawer,
  DrawerClose,
  DrawerContent,
  DrawerDescription,
  DrawerFooter,
  DrawerHeader,
  DrawerTitle,
} from '@/components/ui/drawer';
import { Button } from '@/components/ui/button';

// -----------------------------------------------------------------------------
// Types
// -----------------------------------------------------------------------------

/**
 * Props for the AppShell component.
 */
interface AppShellProps {
  /** Child content to render in the main area */
  children: ReactNode;
  /** Optional additional CSS classes for the wrapper */
  className?: string;
}

/**
 * Settings drawer context type.
 */
interface SettingsDrawerContextType {
  /** Whether the settings drawer is open */
  isOpen: boolean;
  /** Open the settings drawer */
  open: () => void;
  /** Close the settings drawer */
  close: () => void;
  /** Toggle the settings drawer */
  toggle: () => void;
}

// -----------------------------------------------------------------------------
// Context
// -----------------------------------------------------------------------------

const SettingsDrawerContext = createContext<SettingsDrawerContextType | null>(null);

/**
 * Hook to access the settings drawer context.
 * Must be used within an AppShell component.
 *
 * @example
 * ```tsx
 * function SettingsButton() {
 *   const { open } = useSettingsDrawer();
 *   return <Button onClick={open}>Open Settings</Button>;
 * }
 * ```
 */
export function useSettingsDrawer(): SettingsDrawerContextType {
  const context = useContext(SettingsDrawerContext);
  if (!context) {
    throw new Error('useSettingsDrawer must be used within an AppShell');
  }
  return context;
}

// -----------------------------------------------------------------------------
// Settings Drawer Content
// -----------------------------------------------------------------------------

interface SettingsDrawerContentProps {
  /** Function to close the drawer */
  onClose: () => void;
}

/**
 * Content for the settings drawer.
 * Contains links to various configuration sections.
 */
function SettingsDrawerContent({ onClose }: SettingsDrawerContentProps): ReactNode {
  const [, setSearchParams] = useSearchParams();

  const handleNavigate = useCallback(
    (section: string) => {
      // Update URL to reflect the settings section
      setSearchParams({ tab: 'settings', section });
      onClose();
    },
    [setSearchParams, onClose]
  );

  const settingsSections = [
    {
      id: 'bluetooth',
      label: 'Bluetooth Device',
      description: 'Change the device being tracked',
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M7 10l5-5 5 5M7 14l5 5 5-5"
          />
        </svg>
      ),
    },
    {
      id: 'wifi',
      label: 'Wi-Fi Networks',
      description: 'Manage network connections',
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 011.06 0z"
          />
        </svg>
      ),
    },
    {
      id: 'passes',
      label: 'Monthly Passes',
      description: 'Configure pass allocation',
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 010 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 010-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375z"
          />
        </svg>
      ),
    },
    {
      id: 'timezone',
      label: 'Timezone',
      description: 'Set your local timezone',
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
      ),
    },
    {
      id: 'ticket',
      label: 'Remote Access',
      description: 'View dumbpipe connection ticket',
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"
          />
        </svg>
      ),
    },
    {
      id: 'system',
      label: 'System',
      description: 'Restart and advanced options',
      icon: (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M5.636 5.636a9 9 0 1012.728 0M12 3v9"
          />
        </svg>
      ),
    },
  ];

  return (
    <>
      <DrawerHeader className="text-left">
        <DrawerTitle>Settings</DrawerTitle>
        <DrawerDescription>Configure your Tether device</DrawerDescription>
      </DrawerHeader>

      <div className="flex flex-col gap-1 px-4">
        {settingsSections.map((section) => (
          <button
            key={section.id}
            onClick={() => handleNavigate(section.id)}
            className={cn(
              'flex items-center gap-3 rounded-lg p-3 text-left',
              'transition-colors duration-150',
              'hover:bg-accent active:bg-accent/80'
            )}
          >
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-muted">
              {section.icon}
            </div>
            <div className="flex flex-col">
              <span className="text-sm font-medium">{section.label}</span>
              <span className="text-xs text-muted-foreground">
                {section.description}
              </span>
            </div>
          </button>
        ))}
      </div>

      <DrawerFooter className="pt-4">
        <DrawerClose asChild>
          <Button variant="outline" className="w-full">
            Close
          </Button>
        </DrawerClose>
      </DrawerFooter>
    </>
  );
}

// -----------------------------------------------------------------------------
// AppShell Component
// -----------------------------------------------------------------------------

/**
 * Main application shell component.
 *
 * Provides the overall layout structure including:
 * - Scrollable main content area
 * - Fixed bottom navigation
 * - Settings drawer (triggered from Settings tab)
 * - Safe area handling for mobile devices
 *
 * @example
 * ```tsx
 * <AppShell>
 *   <DashboardPage />
 * </AppShell>
 * ```
 */
export function AppShell({ children, className }: AppShellProps): ReactNode {
  const [isDrawerOpen, setIsDrawerOpen] = useState(false);
  const [searchParams] = useSearchParams();

  // Check if we're on the settings tab
  const currentTab = searchParams.get('tab') || 'status';
  const isSettingsTab = currentTab === 'settings';

  // Drawer control functions
  const openDrawer = useCallback(() => setIsDrawerOpen(true), []);
  const closeDrawer = useCallback(() => setIsDrawerOpen(false), []);
  const toggleDrawer = useCallback(() => setIsDrawerOpen((prev) => !prev), []);

  // Context value
  const contextValue: SettingsDrawerContextType = {
    isOpen: isDrawerOpen,
    open: openDrawer,
    close: closeDrawer,
    toggle: toggleDrawer,
  };

  return (
    <SettingsDrawerContext.Provider value={contextValue}>
      <div
        className={cn(
          // Full viewport height
          'flex h-[100dvh] flex-col',
          // Background
          'bg-background',
          // Safe area padding for top
          'pt-[env(safe-area-inset-top,0px)]',
          className
        )}
      >
        {/* Main scrollable content area */}
        <main
          className={cn(
            // Flex grow to fill available space
            'flex-1 overflow-y-auto overflow-x-hidden',
            // Bottom padding to account for fixed navigation
            // 64px nav height + safe area
            'pb-[calc(64px+env(safe-area-inset-bottom,0px))]',
            // Smooth scrolling
            'scroll-smooth',
            // Hide scrollbar on mobile for cleaner look (optional)
            'scrollbar-thin scrollbar-track-transparent scrollbar-thumb-muted'
          )}
        >
          {children}
        </main>

        {/* Fixed bottom navigation */}
        <MobileNav />

        {/* Settings drawer - controlled by tab state or manual trigger */}
        <Drawer
          open={isDrawerOpen || isSettingsTab}
          onOpenChange={(open) => {
            if (!open && isSettingsTab) {
              // Don't close if we're on settings tab - just close the drawer UI
              setIsDrawerOpen(false);
            } else {
              setIsDrawerOpen(open);
            }
          }}
        >
          <DrawerContent className="max-h-[85vh]">
            <SettingsDrawerContent onClose={closeDrawer} />
          </DrawerContent>
        </Drawer>
      </div>
    </SettingsDrawerContext.Provider>
  );
}

// -----------------------------------------------------------------------------
// Exports
// -----------------------------------------------------------------------------

export type { AppShellProps, SettingsDrawerContextType };
```

---

## 9. File: `src/pages/OnboardingPage.tsx`

**Purpose:** Multi-step onboarding flow page component.

```tsx
// =============================================================================
// File: src/pages/OnboardingPage.tsx
// Description: Onboarding flow for first-time device setup.
// =============================================================================

import {
  type ReactNode,
  useState,
  useCallback,
  useMemo,
} from 'react';
import { useNavigate } from 'react-router-dom';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { cn } from '@/lib/utils';
import { queryKeys } from '@/lib/queryClient';
import { Button } from '@/components/ui/button';

// -----------------------------------------------------------------------------
// Types
// -----------------------------------------------------------------------------

/**
 * Onboarding step identifiers.
 */
type OnboardingStepId =
  | 'welcome'
  | 'bluetooth'
  | 'signal'
  | 'passes'
  | 'wifi'
  | 'timezone'
  | 'complete';

/**
 * Step configuration.
 */
interface OnboardingStep {
  id: OnboardingStepId;
  title: string;
  description: string;
  component: ReactNode;
}

/**
 * Onboarding form data collected across all steps.
 */
interface OnboardingFormData {
  bluetoothDevice: string | null;
  signalThreshold: number;
  passesPerMonth: number;
  wifiNetworks: WifiNetwork[];
  primaryWifiNetwork: string | null;
  timezone: string;
}

/**
 * Wi-Fi network configuration.
 */
interface WifiNetwork {
  ssid: string;
  password?: string;
  isPrimary: boolean;
}

// -----------------------------------------------------------------------------
// Step Components
// -----------------------------------------------------------------------------

interface StepProps {
  data: OnboardingFormData;
  onUpdate: (updates: Partial<OnboardingFormData>) => void;
  onNext: () => void;
  onBack: () => void;
  isFirstStep: boolean;
  isLastStep: boolean;
}

/**
 * Welcome step - introduction to the setup process.
 */
function WelcomeStep({ onNext }: StepProps): ReactNode {
  return (
    <div className="flex flex-col items-center gap-6 text-center">
      <div className="flex h-20 w-20 items-center justify-center rounded-full bg-primary/10">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={1.5}
          className="h-10 w-10 text-primary"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"
          />
        </svg>
      </div>

      <div>
        <h2 className="text-2xl font-bold">Welcome to Tether</h2>
        <p className="mt-2 text-muted-foreground">
          Let's set up your device to help you maintain healthy phone habits at night.
        </p>
      </div>

      <div className="w-full space-y-3 text-left">
        <div className="flex items-start gap-3 rounded-lg bg-muted/50 p-3">
          <div className="mt-0.5 h-5 w-5 rounded-full bg-primary/20 text-center text-xs font-medium leading-5 text-primary">
            1
          </div>
          <div>
            <p className="text-sm font-medium">Connect your phone</p>
            <p className="text-xs text-muted-foreground">
              We'll detect your phone via Bluetooth
            </p>
          </div>
        </div>

        <div className="flex items-start gap-3 rounded-lg bg-muted/50 p-3">
          <div className="mt-0.5 h-5 w-5 rounded-full bg-primary/20 text-center text-xs font-medium leading-5 text-primary">
            2
          </div>
          <div>
            <p className="text-sm font-medium">Set your boundaries</p>
            <p className="text-xs text-muted-foreground">
              Configure passes for nights you need flexibility
            </p>
          </div>
        </div>

        <div className="flex items-start gap-3 rounded-lg bg-muted/50 p-3">
          <div className="mt-0.5 h-5 w-5 rounded-full bg-primary/20 text-center text-xs font-medium leading-5 text-primary">
            3
          </div>
          <div>
            <p className="text-sm font-medium">Connect to Wi-Fi</p>
            <p className="text-xs text-muted-foreground">
              Enable remote access from anywhere
            </p>
          </div>
        </div>
      </div>

      <Button onClick={onNext} className="w-full" size="lg">
        Get Started
      </Button>
    </div>
  );
}

/**
 * Bluetooth device selection step.
 */
function BluetoothStep({ data, onUpdate, onNext, onBack }: StepProps): ReactNode {
  const [isScanning, setIsScanning] = useState(false);
  const [devices, setDevices] = useState<Array<{ id: string; name: string; rssi: number }>>([]);

  const handleScan = useCallback(async () => {
    setIsScanning(true);
    try {
      // TODO: Replace with actual API call
      const response = await fetch('/api/bluetooth/scan');
      const data = await response.json();
      setDevices(data.devices);
    } catch (error) {
      console.error('Failed to scan for devices:', error);
    } finally {
      setIsScanning(false);
    }
  }, []);

  const handleSelectDevice = useCallback(
    (deviceId: string) => {
      onUpdate({ bluetoothDevice: deviceId });
    },
    [onUpdate]
  );

  return (
    <div className="flex flex-col gap-6">
      <div className="text-center">
        <h2 className="text-xl font-bold">Select Your Phone</h2>
        <p className="mt-1 text-sm text-muted-foreground">
          Make sure Bluetooth is enabled on your phone
        </p>
      </div>

      <Button
        onClick={handleScan}
        disabled={isScanning}
        variant="outline"
        className="w-full"
      >
        {isScanning ? (
          <>
            <span className="mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
            Scanning...
          </>
        ) : (
          'Scan for Devices'
        )}
      </Button>

      {devices.length > 0 && (
        <div className="space-y-2">
          {devices.map((device) => (
            <button
              key={device.id}
              onClick={() => handleSelectDevice(device.id)}
              className={cn(
                'flex w-full items-center justify-between rounded-lg border p-3 transition-colors',
                data.bluetoothDevice === device.id
                  ? 'border-primary bg-primary/5'
                  : 'border-border hover:bg-muted/50'
              )}
            >
              <div className="flex items-center gap-3">
                <div className="flex h-10 w-10 items-center justify-center rounded-full bg-muted">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth={1.5}
                    className="h-5 w-5"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"
                    />
                  </svg>
                </div>
                <span className="font-medium">{device.name || 'Unknown Device'}</span>
              </div>
              <span className="text-sm text-muted-foreground">
                {device.rssi} dBm
              </span>
            </button>
          ))}
        </div>
      )}

      <div className="flex gap-3 pt-4">
        <Button onClick={onBack} variant="outline" className="flex-1">
          Back
        </Button>
        <Button
          onClick={onNext}
          disabled={!data.bluetoothDevice}
          className="flex-1"
        >
          Continue
        </Button>
      </div>
    </div>
  );
}

/**
 * Signal threshold configuration step.
 */
function SignalStep({ data, onUpdate, onNext, onBack }: StepProps): ReactNode {
  const [currentSignal, setCurrentSignal] = useState<number | null>(null);

  // TODO: Add real-time signal strength polling

  return (
    <div className="flex flex-col gap-6">
      <div className="text-center">
        <h2 className="text-xl font-bold">Set Proximity Threshold</h2>
        <p className="mt-1 text-sm text-muted-foreground">
          Walk to where you want to leave your phone and adjust the threshold
        </p>
      </div>

      <div className="rounded-lg bg-muted/50 p-4 text-center">
        <p className="text-sm text-muted-foreground">Current Signal Strength</p>
        <p className="text-3xl font-bold">
          {currentSignal !== null ? `${currentSignal} dBm` : '---'}
        </p>
      </div>

      <div className="space-y-2">
        <label className="text-sm font-medium">
          Threshold: {data.signalThreshold} dBm
        </label>
        <input
          type="range"
          min="-100"
          max="-30"
          value={data.signalThreshold}
          onChange={(e) =>
            onUpdate({ signalThreshold: parseInt(e.target.value, 10) })
          }
          className="w-full"
        />
        <div className="flex justify-between text-xs text-muted-foreground">
          <span>Far away</span>
          <span>Very close</span>
        </div>
      </div>

      <p className="text-center text-xs text-muted-foreground">
        Your phone will be considered "nearby" when the signal is stronger than{' '}
        {data.signalThreshold} dBm
      </p>

      <div className="flex gap-3 pt-4">
        <Button onClick={onBack} variant="outline" className="flex-1">
          Back
        </Button>
        <Button onClick={onNext} className="flex-1">
          Continue
        </Button>
      </div>
    </div>
  );
}

/**
 * Passes configuration step.
 */
function PassesStep({ data, onUpdate, onNext, onBack }: StepProps): ReactNode {
  const presets = [3, 5, 7, 10];

  return (
    <div className="flex flex-col gap-6">
      <div className="text-center">
        <h2 className="text-xl font-bold">Monthly Passes</h2>
        <p className="mt-1 text-sm text-muted-foreground">
          How many nights per month can you keep your phone nearby?
        </p>
      </div>

      <div className="grid grid-cols-4 gap-2">
        {presets.map((preset) => (
          <button
            key={preset}
            onClick={() => onUpdate({ passesPerMonth: preset })}
            className={cn(
              'rounded-lg border py-3 text-center font-medium transition-colors',
              data.passesPerMonth === preset
                ? 'border-primary bg-primary text-primary-foreground'
                : 'border-border hover:bg-muted/50'
            )}
          >
            {preset}
          </button>
        ))}
      </div>

      <div className="space-y-2">
        <label className="text-sm font-medium">
          Or set a custom amount: {data.passesPerMonth} passes
        </label>
        <input
          type="range"
          min="0"
          max="31"
          value={data.passesPerMonth}
          onChange={(e) =>
            onUpdate({ passesPerMonth: parseInt(e.target.value, 10) })
          }
          className="w-full"
        />
      </div>

      <p className="text-center text-xs text-muted-foreground">
        Passes reset on the first day of each month. You can change this later,
        but changes only take effect the following month.
      </p>

      <div className="flex gap-3 pt-4">
        <Button onClick={onBack} variant="outline" className="flex-1">
          Back
        </Button>
        <Button onClick={onNext} className="flex-1">
          Continue
        </Button>
      </div>
    </div>
  );
}

/**
 * Wi-Fi configuration step.
 */
function WifiStep({ data, onUpdate, onNext, onBack }: StepProps): ReactNode {
  const [ssid, setSsid] = useState('');
  const [password, setPassword] = useState('');
  const [isConnecting, setIsConnecting] = useState(false);

  const handleAddNetwork = useCallback(async () => {
    if (!ssid) return;

    setIsConnecting(true);
    try {
      // TODO: Replace with actual API call to connect to Wi-Fi
      const isPrimary = data.wifiNetworks.length === 0;
      const newNetwork: WifiNetwork = {
        ssid,
        password: password || undefined,
        isPrimary,
      };

      onUpdate({
        wifiNetworks: [...data.wifiNetworks, newNetwork],
        primaryWifiNetwork: isPrimary ? ssid : data.primaryWifiNetwork,
      });

      setSsid('');
      setPassword('');
    } catch (error) {
      console.error('Failed to add network:', error);
    } finally {
      setIsConnecting(false);
    }
  }, [ssid, password, data.wifiNetworks, data.primaryWifiNetwork, onUpdate]);

  return (
    <div className="flex flex-col gap-6">
      <div className="text-center">
        <h2 className="text-xl font-bold">Connect to Wi-Fi</h2>
        <p className="mt-1 text-sm text-muted-foreground">
          {data.wifiNetworks.length === 0
            ? 'Add your primary Wi-Fi network'
            : 'Add additional networks (optional)'}
        </p>
      </div>

      {data.wifiNetworks.length > 0 && (
        <div className="space-y-2">
          <p className="text-sm font-medium">Connected Networks</p>
          {data.wifiNetworks.map((network) => (
            <div
              key={network.ssid}
              className="flex items-center justify-between rounded-lg border p-3"
            >
              <div className="flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  strokeWidth={1.5}
                  className="h-5 w-5 text-green-500"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    d="M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 011.06 0z"
                  />
                </svg>
                <span className="font-medium">{network.ssid}</span>
              </div>
              {network.isPrimary && (
                <span className="rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary">
                  Primary
                </span>
              )}
            </div>
          ))}
        </div>
      )}

      <div className="space-y-3">
        <input
          type="text"
          value={ssid}
          onChange={(e) => setSsid(e.target.value)}
          placeholder="Network name (SSID)"
          className="w-full rounded-lg border border-border bg-background px-3 py-2 text-sm"
        />
        <input
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          placeholder="Password (optional for open networks)"
          className="w-full rounded-lg border border-border bg-background px-3 py-2 text-sm"
        />
        <Button
          onClick={handleAddNetwork}
          disabled={!ssid || isConnecting}
          variant="outline"
          className="w-full"
        >
          {isConnecting ? 'Connecting...' : 'Add Network'}
        </Button>
      </div>

      <div className="flex gap-3 pt-4">
        <Button onClick={onBack} variant="outline" className="flex-1">
          Back
        </Button>
        <Button
          onClick={onNext}
          disabled={data.wifiNetworks.length === 0}
          className="flex-1"
        >
          Continue
        </Button>
      </div>
    </div>
  );
}

/**
 * Timezone configuration step.
 */
function TimezoneStep({ data, onUpdate, onNext, onBack }: StepProps): ReactNode {
  const detectedTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

  // Common timezones
  const timezones = [
    'America/New_York',
    'America/Chicago',
    'America/Denver',
    'America/Los_Angeles',
    'America/Anchorage',
    'Pacific/Honolulu',
    'Europe/London',
    'Europe/Paris',
    'Asia/Tokyo',
    'Asia/Shanghai',
    'Australia/Sydney',
  ];

  return (
    <div className="flex flex-col gap-6">
      <div className="text-center">
        <h2 className="text-xl font-bold">Set Timezone</h2>
        <p className="mt-1 text-sm text-muted-foreground">
          We detected: {detectedTimezone}
        </p>
      </div>

      <Button
        onClick={() => onUpdate({ timezone: detectedTimezone })}
        variant={data.timezone === detectedTimezone ? 'default' : 'outline'}
        className="w-full"
      >
        Use Detected Timezone
      </Button>

      <div className="space-y-2">
        <p className="text-sm font-medium">Or select manually:</p>
        <select
          value={data.timezone}
          onChange={(e) => onUpdate({ timezone: e.target.value })}
          className="w-full rounded-lg border border-border bg-background px-3 py-2 text-sm"
        >
          {timezones.map((tz) => (
            <option key={tz} value={tz}>
              {tz.replace('_', ' ')}
            </option>
          ))}
        </select>
      </div>

      <div className="flex gap-3 pt-4">
        <Button onClick={onBack} variant="outline" className="flex-1">
          Back
        </Button>
        <Button onClick={onNext} className="flex-1">
          Continue
        </Button>
      </div>
    </div>
  );
}

/**
 * Completion step.
 */
function CompleteStep({ data, onNext, onBack, isLastStep }: StepProps): ReactNode {
  return (
    <div className="flex flex-col items-center gap-6 text-center">
      <div className="flex h-20 w-20 items-center justify-center rounded-full bg-green-500/10">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth={2}
          className="h-10 w-10 text-green-500"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M4.5 12.75l6 6 9-13.5"
          />
        </svg>
      </div>

      <div>
        <h2 className="text-2xl font-bold">All Set!</h2>
        <p className="mt-2 text-muted-foreground">
          Your Tether device is ready to help you build better habits.
        </p>
      </div>

      <div className="w-full space-y-2 text-left">
        <div className="rounded-lg bg-muted/50 p-3">
          <p className="text-xs text-muted-foreground">Device</p>
          <p className="font-medium">{data.bluetoothDevice || 'Not set'}</p>
        </div>
        <div className="rounded-lg bg-muted/50 p-3">
          <p className="text-xs text-muted-foreground">Monthly Passes</p>
          <p className="font-medium">{data.passesPerMonth}</p>
        </div>
        <div className="rounded-lg bg-muted/50 p-3">
          <p className="text-xs text-muted-foreground">Primary Network</p>
          <p className="font-medium">{data.primaryWifiNetwork || 'Not set'}</p>
        </div>
        <div className="rounded-lg bg-muted/50 p-3">
          <p className="text-xs text-muted-foreground">Timezone</p>
          <p className="font-medium">{data.timezone}</p>
        </div>
      </div>

      <div className="flex w-full gap-3 pt-4">
        <Button onClick={onBack} variant="outline" className="flex-1">
          Back
        </Button>
        <Button onClick={onNext} className="flex-1">
          Go to Dashboard
        </Button>
      </div>
    </div>
  );
}

// -----------------------------------------------------------------------------
// OnboardingPage Component
// -----------------------------------------------------------------------------

/**
 * Default export for lazy loading.
 */
export default function OnboardingPage(): ReactNode {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  // Current step index
  const [currentStepIndex, setCurrentStepIndex] = useState(0);

  // Form data state
  const [formData, setFormData] = useState<OnboardingFormData>({
    bluetoothDevice: null,
    signalThreshold: -70,
    passesPerMonth: 5,
    wifiNetworks: [],
    primaryWifiNetwork: null,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
  });

  // Update form data
  const updateFormData = useCallback((updates: Partial<OnboardingFormData>) => {
    setFormData((prev) => ({ ...prev, ...updates }));
  }, []);

  // Complete onboarding mutation
  const completeOnboarding = useMutation({
    mutationFn: async (data: OnboardingFormData) => {
      const response = await fetch('/api/onboarding/complete', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });
      if (!response.ok) {
        throw new Error('Failed to complete onboarding');
      }
      return response.json();
    },
    onSuccess: () => {
      // Invalidate onboarding status to trigger redirect
      queryClient.invalidateQueries({ queryKey: queryKeys.onboarding.all });
      navigate('/dashboard');
    },
  });

  // Step definitions
  const steps: OnboardingStep[] = useMemo(
    () => [
      {
        id: 'welcome',
        title: 'Welcome',
        description: 'Introduction to Tether',
        component: <WelcomeStep {...stepProps} />,
      },
      {
        id: 'bluetooth',
        title: 'Bluetooth',
        description: 'Select your phone',
        component: <BluetoothStep {...stepProps} />,
      },
      {
        id: 'signal',
        title: 'Signal',
        description: 'Set proximity threshold',
        component: <SignalStep {...stepProps} />,
      },
      {
        id: 'passes',
        title: 'Passes',
        description: 'Configure monthly passes',
        component: <PassesStep {...stepProps} />,
      },
      {
        id: 'wifi',
        title: 'Wi-Fi',
        description: 'Connect to network',
        component: <WifiStep {...stepProps} />,
      },
      {
        id: 'timezone',
        title: 'Timezone',
        description: 'Set your timezone',
        component: <TimezoneStep {...stepProps} />,
      },
      {
        id: 'complete',
        title: 'Complete',
        description: 'Setup complete',
        component: <CompleteStep {...stepProps} />,
      },
    ],
    [] // Intentionally empty - stepProps is created below
  );

  // Navigation handlers
  const handleNext = useCallback(() => {
    if (currentStepIndex === steps.length - 1) {
      completeOnboarding.mutate(formData);
    } else {
      setCurrentStepIndex((prev) => Math.min(prev + 1, steps.length - 1));
    }
  }, [currentStepIndex, steps.length, formData, completeOnboarding]);

  const handleBack = useCallback(() => {
    setCurrentStepIndex((prev) => Math.max(prev - 1, 0));
  }, []);

  // Step props passed to each step component
  const stepProps: StepProps = {
    data: formData,
    onUpdate: updateFormData,
    onNext: handleNext,
    onBack: handleBack,
    isFirstStep: currentStepIndex === 0,
    isLastStep: currentStepIndex === steps.length - 1,
  };

  // Current step
  const currentStep = steps[currentStepIndex];

  // Recreate steps with current stepProps
  const stepsWithProps: OnboardingStep[] = [
    {
      id: 'welcome',
      title: 'Welcome',
      description: 'Introduction to Tether',
      component: <WelcomeStep {...stepProps} />,
    },
    {
      id: 'bluetooth',
      title: 'Bluetooth',
      description: 'Select your phone',
      component: <BluetoothStep {...stepProps} />,
    },
    {
      id: 'signal',
      title: 'Signal',
      description: 'Set proximity threshold',
      component: <SignalStep {...stepProps} />,
    },
    {
      id: 'passes',
      title: 'Passes',
      description: 'Configure monthly passes',
      component: <PassesStep {...stepProps} />,
    },
    {
      id: 'wifi',
      title: 'Wi-Fi',
      description: 'Connect to network',
      component: <WifiStep {...stepProps} />,
    },
    {
      id: 'timezone',
      title: 'Timezone',
      description: 'Set your timezone',
      component: <TimezoneStep {...stepProps} />,
    },
    {
      id: 'complete',
      title: 'Complete',
      description: 'Setup complete',
      component: <CompleteStep {...stepProps} />,
    },
  ];

  return (
    <div className="flex min-h-[100dvh] flex-col bg-background">
      {/* Progress indicator */}
      <div className="flex items-center justify-center gap-1 px-6 py-4">
        {stepsWithProps.map((step, index) => (
          <div
            key={step.id}
            className={cn(
              'h-1 flex-1 rounded-full transition-colors',
              index <= currentStepIndex ? 'bg-primary' : 'bg-muted'
            )}
          />
        ))}
      </div>

      {/* Step content */}
      <div className="flex flex-1 flex-col px-6 py-4">
        {stepsWithProps[currentStepIndex].component}
      </div>

      {/* Loading overlay for mutation */}
      {completeOnboarding.isPending && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm">
          <div className="flex flex-col items-center gap-4">
            <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
            <p className="text-sm text-muted-foreground">Completing setup...</p>
          </div>
        </div>
      )}
    </div>
  );
}
```

---

## 10. File: `src/pages/DashboardPage.tsx`

**Purpose:** Main dashboard with tab-based content display.

```tsx
// =============================================================================
// File: src/pages/DashboardPage.tsx
// Description: Main dashboard page with tabbed content based on URL params.
// =============================================================================

import { type ReactNode, useMemo, Suspense, lazy } from 'react';
import { useSearchParams } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { cn } from '@/lib/utils';
import { queryKeys } from '@/lib/queryClient';
import { useSettingsDrawer } from '@/components/layout/AppShell';

// -----------------------------------------------------------------------------
// Types
// -----------------------------------------------------------------------------

/**
 * Dashboard tab identifiers.
 */
type DashboardTab = 'status' | 'passes' | 'settings';

/**
 * Device proximity status from API.
 */
interface DeviceProximityStatus {
  device_name: string;
  is_nearby: boolean;
  signal_strength: number;
  last_seen: string;
}

/**
 * Pass information from API.
 */
interface PassInfo {
  remaining: number;
  total: number;
  used_this_month: number;
  next_refresh: string;
}

/**
 * Pass history entry.
 */
interface PassHistoryEntry {
  id: string;
  used_at_utc: string;
  reason: string;
}

// -----------------------------------------------------------------------------
// Tab Content Components
// -----------------------------------------------------------------------------

/**
 * Loading skeleton for tab content.
 */
function TabLoadingSkeleton(): ReactNode {
  return (
    <div className="animate-pulse space-y-4 p-4">
      <div className="h-8 w-3/4 rounded bg-muted" />
      <div className="h-32 rounded-lg bg-muted" />
      <div className="h-4 w-1/2 rounded bg-muted" />
      <div className="h-24 rounded-lg bg-muted" />
    </div>
  );
}

/**
 * Status tab content - shows device proximity and signal strength.
 */
function StatusTabContent(): ReactNode {
  const { data, isLoading, error, refetch } = useQuery<DeviceProximityStatus>({
    queryKey: queryKeys.device.proximity(),
    queryFn: async () => {
      const response = await fetch('/api/device/proximity');
      if (!response.ok) throw new Error('Failed to fetch device status');
      return response.json();
    },
    refetchInterval: 5000, // Poll every 5 seconds for real-time updates
  });

  if (isLoading) {
    return <TabLoadingSkeleton />;
  }

  if (error) {
    return (
      <div className="flex flex-col items-center justify-center gap-4 p-8 text-center">
        <p className="text-sm text-destructive">Failed to load device status</p>
        <button
          onClick={() => refetch()}
          className="text-sm text-primary underline"
        >
          Try again
        </button>
      </div>
    );
  }

  const isNearby = data?.is_nearby ?? false;
  const signalStrength = data?.signal_strength ?? 0;
  const deviceName = data?.device_name ?? 'Unknown Device';

  return (
    <div className="space-y-6 p-4">
      {/* Header */}
      <div className="text-center">
        <h1 className="text-2xl font-bold">Device Status</h1>
        <p className="text-sm text-muted-foreground">{deviceName}</p>
      </div>

      {/* Main status card */}
      <div
        className={cn(
          'flex flex-col items-center gap-4 rounded-2xl p-8 text-center',
          isNearby
            ? 'bg-green-500/10 text-green-700 dark:text-green-400'
            : 'bg-red-500/10 text-red-700 dark:text-red-400'
        )}
      >
        <div
          className={cn(
            'flex h-24 w-24 items-center justify-center rounded-full',
            isNearby ? 'bg-green-500/20' : 'bg-red-500/20'
          )}
        >
          {isNearby ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              className="h-12 w-12"
            >
              <path
                fillRule="evenodd"
                d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
                clipRule="evenodd"
              />
            </svg>
          ) : (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              className="h-12 w-12"
            >
              <path
                fillRule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z"
                clipRule="evenodd"
              />
            </svg>
          )}
        </div>

        <div>
          <p className="text-2xl font-bold">
            {isNearby ? 'Phone Nearby' : 'Phone Away'}
          </p>
          <p className="mt-1 text-sm opacity-80">
            {isNearby
              ? 'Your phone is within range'
              : 'Your phone is outside the designated area'}
          </p>
        </div>
      </div>

      {/* Signal strength */}
      <div className="rounded-xl bg-muted/50 p-4">
        <div className="flex items-center justify-between">
          <span className="text-sm font-medium">Signal Strength</span>
          <span className="text-sm text-muted-foreground">
            {signalStrength} dBm
          </span>
        </div>
        <div className="mt-2 h-2 overflow-hidden rounded-full bg-muted">
          <div
            className={cn(
              'h-full rounded-full transition-all',
              signalStrength > -50
                ? 'bg-green-500'
                : signalStrength > -70
                  ? 'bg-yellow-500'
                  : 'bg-red-500'
            )}
            style={{
              width: `${Math.max(0, Math.min(100, ((signalStrength + 100) / 70) * 100))}%`,
            }}
          />
        </div>
      </div>

      {/* Last seen */}
      {data?.last_seen && (
        <p className="text-center text-xs text-muted-foreground">
          Last updated: {new Date(data.last_seen).toLocaleTimeString()}
        </p>
      )}
    </div>
  );
}

/**
 * Passes tab content - shows pass usage and history.
 */
function PassesTabContent(): ReactNode {
  const passesQuery = useQuery<PassInfo>({
    queryKey: queryKeys.passes.remaining(),
    queryFn: async () => {
      const response = await fetch('/api/passes/remaining');
      if (!response.ok) throw new Error('Failed to fetch passes');
      return response.json();
    },
  });

  const historyQuery = useQuery<PassHistoryEntry[]>({
    queryKey: queryKeys.passes.history(),
    queryFn: async () => {
      const response = await fetch('/api/passes/history');
      if (!response.ok) throw new Error('Failed to fetch pass history');
      return response.json();
    },
  });

  if (passesQuery.isLoading) {
    return <TabLoadingSkeleton />;
  }

  const passes = passesQuery.data;
  const history = historyQuery.data ?? [];

  return (
    <div className="space-y-6 p-4">
      {/* Header */}
      <div className="text-center">
        <h1 className="text-2xl font-bold">Monthly Passes</h1>
        <p className="text-sm text-muted-foreground">
          For nights when you need flexibility
        </p>
      </div>

      {/* Pass counter */}
      <div className="flex flex-col items-center rounded-2xl bg-primary/10 p-8">
        <div className="flex items-baseline gap-1">
          <span className="text-6xl font-bold text-primary">
            {passes?.remaining ?? 0}
          </span>
          <span className="text-2xl text-primary/60">
            / {passes?.total ?? 0}
          </span>
        </div>
        <p className="mt-2 text-sm text-muted-foreground">Passes remaining</p>
      </div>

      {/* Use pass button */}
      <button
        className={cn(
          'w-full rounded-xl py-4 text-center font-medium transition-colors',
          passes?.remaining && passes.remaining > 0
            ? 'bg-primary text-primary-foreground hover:bg-primary/90'
            : 'cursor-not-allowed bg-muted text-muted-foreground'
        )}
        disabled={!passes?.remaining || passes.remaining <= 0}
      >
        Use a Pass Tonight
      </button>

      {/* Next refresh */}
      {passes?.next_refresh && (
        <p className="text-center text-xs text-muted-foreground">
          Passes refresh on{' '}
          {new Date(passes.next_refresh).toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
          })}
        </p>
      )}

      {/* History */}
      <div className="space-y-3">
        <h2 className="text-lg font-semibold">This Month's History</h2>

        {history.length === 0 ? (
          <p className="rounded-lg bg-muted/50 p-4 text-center text-sm text-muted-foreground">
            No passes used this month
          </p>
        ) : (
          <div className="space-y-2">
            {history.map((entry) => (
              <div
                key={entry.id}
                className="flex items-start justify-between rounded-lg bg-muted/50 p-3"
              >
                <div>
                  <p className="text-sm font-medium">{entry.reason}</p>
                  <p className="text-xs text-muted-foreground">
                    {new Date(entry.used_at_utc).toLocaleDateString('en-US', {
                      month: 'short',
                      day: 'numeric',
                      hour: 'numeric',
                      minute: '2-digit',
                    })}
                  </p>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

/**
 * Settings tab content - configuration options.
 * Note: Full settings are shown in the drawer, this is a summary view.
 */
function SettingsTabContent(): ReactNode {
  const { open: openDrawer } = useSettingsDrawer();

  return (
    <div className="space-y-6 p-4">
      <div className="text-center">
        <h1 className="text-2xl font-bold">Settings</h1>
        <p className="text-sm text-muted-foreground">
          Configure your Tether device
        </p>
      </div>

      {/* Quick settings preview - drawer will show full options */}
      <div className="space-y-3">
        <button
          onClick={openDrawer}
          className="flex w-full items-center justify-between rounded-xl bg-muted/50 p-4 transition-colors hover:bg-muted"
        >
          <div className="flex items-center gap-3">
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-background">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth={1.5}
                className="h-5 w-5"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"
                />
              </svg>
            </div>
            <span className="font-medium">Open All Settings</span>
          </div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth={1.5}
            className="h-5 w-5 text-muted-foreground"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M8.25 4.5l7.5 7.5-7.5 7.5"
            />
          </svg>
        </button>
      </div>

      {/* SSH instructions */}
      <div className="rounded-xl border border-border p-4">
        <h3 className="font-medium">SSH Access</h3>
        <p className="mt-1 text-sm text-muted-foreground">
          Connect to your Tether device via SSH for advanced debugging:
        </p>
        <code className="mt-2 block rounded bg-muted p-2 text-xs">
          ssh tether@tether.local
        </code>
      </div>
    </div>
  );
}

// -----------------------------------------------------------------------------
// DashboardPage Component
// -----------------------------------------------------------------------------

/**
 * Main dashboard page component.
 *
 * Reads the current tab from URL search params and renders the appropriate
 * content. Defaults to 'status' tab if none specified.
 *
 * @example URL: /dashboard?tab=passes
 */
export default function DashboardPage(): ReactNode {
  const [searchParams] = useSearchParams();

  // Get current tab from URL, default to 'status'
  const currentTab = useMemo<DashboardTab>(() => {
    const tab = searchParams.get('tab');
    if (tab === 'status' || tab === 'passes' || tab === 'settings') {
      return tab;
    }
    return 'status';
  }, [searchParams]);

  // Render content based on current tab
  const content = useMemo(() => {
    switch (currentTab) {
      case 'status':
        return <StatusTabContent />;
      case 'passes':
        return <PassesTabContent />;
      case 'settings':
        return <SettingsTabContent />;
      default:
        return <StatusTabContent />;
    }
  }, [currentTab]);

  return (
    <Suspense fallback={<TabLoadingSkeleton />}>
      {content}
    </Suspense>
  );
}
```

---

## 11. Additional Required Files

### `src/index.css`

```css
/* =============================================================================
   File: src/index.css
   Description: Global styles with Tailwind CSS imports.
   ============================================================================= */

@import "tailwindcss";

/* -----------------------------------------------------------------------------
   CSS Variables for shadcn/ui theming
   ----------------------------------------------------------------------------- */
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 240 10% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 3.9%;
    --primary: 240 5.9% 10%;
    --primary-foreground: 0 0% 98%;
    --secondary: 240 4.8% 95.9%;
    --secondary-foreground: 240 5.9% 10%;
    --muted: 240 4.8% 95.9%;
    --muted-foreground: 240 3.8% 46.1%;
    --accent: 240 4.8% 95.9%;
    --accent-foreground: 240 5.9% 10%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 240 5.9% 10%;
    --radius: 0.75rem;
  }

  .dark {
    --background: 240 10% 3.9%;
    --foreground: 0 0% 98%;
    --card: 240 10% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 240 10% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 240 5.9% 10%;
    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;
    --accent: 240 3.7% 15.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 240 4.9% 83.9%;
  }
}

/* -----------------------------------------------------------------------------
   Base styles
   ----------------------------------------------------------------------------- */
@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Prevent pull-to-refresh on mobile */
  html {
    overscroll-behavior: none;
  }

  /* Safe area handling for notched devices */
  body {
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
}

/* -----------------------------------------------------------------------------
   Scrollbar styles (optional - for webkit browsers)
   ----------------------------------------------------------------------------- */
@layer utilities {
  .scrollbar-thin {
    scrollbar-width: thin;
  }

  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .scrollbar-thumb-muted::-webkit-scrollbar-thumb {
    background-color: hsl(var(--muted));
    border-radius: 3px;
  }

  .scrollbar-track-transparent::-webkit-scrollbar-track {
    background-color: transparent;
  }
}
```

### `openapi-ts.config.ts`

```ts
// =============================================================================
// File: openapi-ts.config.ts
// Description: Configuration for @hey-api/openapi-ts client generation.
// =============================================================================

import { defineConfig } from '@hey-api/openapi-ts';

export default defineConfig({
  // Input: OpenAPI spec from the Rust backend
  // This path should point to where the Rust backend outputs the OpenAPI JSON
  input: '../backend/openapi.json',

  // Output: Generated client code location
  output: {
    path: 'src/client',
    format: 'prettier',
    lint: 'biome',
  },

  // Plugins configuration
  plugins: [
    // Generate fetch client
    {
      name: '@hey-api/client-fetch',
      runtimeConfigPath: './src/lib/hey-api.ts',
    },

    // Generate TypeScript types
    '@hey-api/typescript',

    // Generate SDK functions
    '@hey-api/sdk',

    // Generate React Query hooks
    {
      name: '@tanstack/react-query',
      queryOptions: true,
      mutationOptions: true,
    },
  ],
});
```

### `src/lib/hey-api.ts`

```ts
// =============================================================================
// File: src/lib/hey-api.ts
// Description: Runtime configuration for the generated API client.
// =============================================================================

import type { CreateClientConfig } from '@/client/client.gen';

/**
 * Runtime configuration for the Hey API client.
 *
 * This function is called when the client is created and allows us to
 * set the base URL and other configuration options at runtime.
 */
export const createClientConfig: CreateClientConfig = (config) => ({
  ...config,
  // Base URL is relative since the API is served from the same origin
  // The Raspberry Pi serves both the frontend and the API
  baseUrl: '/api',
});
```

---

## 12. Package Dependencies

Here is the complete `package.json` dependencies section:

```json
{
  "name": "tether-web-ui",
  "private": true,
  "version": "0.0.1",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview",
    "lint": "biome check .",
    "lint:fix": "biome check --write .",
    "format": "biome format --write .",
    "openapi-ts": "openapi-ts",
    "generate-client": "openapi-ts"
  },
  "dependencies": {
    "@tanstack/react-query": "^5.62.0",
    "clsx": "^2.1.1",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-error-boundary": "^4.1.2",
    "react-router-dom": "^6.28.0",
    "tailwind-merge": "^2.5.5",
    "vaul": "^1.1.1"
  },
  "devDependencies": {
    "@biomejs/biome": "1.9.4",
    "@hey-api/client-fetch": "^0.6.0",
    "@hey-api/openapi-ts": "^0.61.0",
    "@tailwindcss/vite": "^4.0.0",
    "@tanstack/react-query-devtools": "^5.62.0",
    "@types/node": "^22.10.2",
    "@types/react": "^18.3.14",
    "@types/react-dom": "^18.3.2",
    "@vitejs/plugin-react": "^4.3.4",
    "tailwindcss": "^4.0.0",
    "typescript": "~5.7.2",
    "vite": "^6.0.3"
  }
}
```

---

## 13. shadcn/ui Components Required

Run these commands to add the required shadcn/ui components:

```bash
npx shadcn@latest add button
npx shadcn@latest add drawer
```

The Drawer component uses `vaul` under the hood, which is already included in dependencies.

---

## 14. TypeScript Configuration

### `tsconfig.json`

```json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

### `tsconfig.app.json`

```json
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true,

    /* Path aliases */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}
```

---

## 15. Vite Configuration

### `vite.config.ts`

```ts
// =============================================================================
// File: vite.config.ts
// Description: Vite configuration for the Tether web UI.
// =============================================================================

import path from 'path';
import tailwindcss from '@tailwindcss/vite';
import react from '@vitejs/plugin-react';
import { defineConfig } from 'vite';

export default defineConfig({
  plugins: [react(), tailwindcss()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    // Proxy API requests to the Rust backend during development
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      },
    },
  },
  build: {
    // Output directory for production build
    outDir: 'dist',
    // Generate source maps for debugging
    sourcemap: true,
    // Optimize for Raspberry Pi (smaller bundle size)
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    },
  },
});
```

---

## Critical Files for Implementation

### Critical Files for Implementation

- `/Users/jeffrey/code/tether/web-ui/src/App.tsx` - Root component with providers, routing, and redirect logic based on onboarding state
- `/Users/jeffrey/code/tether/web-ui/src/components/layout/AppShell.tsx` - Main layout wrapper with scrollable content, bottom nav, and settings drawer integration
- `/Users/jeffrey/code/tether/web-ui/src/components/layout/MobileNav.tsx` - iOS-style bottom tab navigation with active state styling
- `/Users/jeffrey/code/tether/web-ui/src/hooks/useOnboardingState.ts` - Hook for checking onboarding completion status from API
- `/Users/jeffrey/code/tether/web-ui/src/lib/queryClient.ts` - React Query client configuration with mobile-optimized defaults and query key factory
